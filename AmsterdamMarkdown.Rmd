---
title: "Amsterdam"
output: html_document
date: "2024-04-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r
Combining Weekdays and Weekends Datasets for Amsterdam into a single dataframe
amsterdam_weekdays <- read.csv("~/Airbnb data/amsterdam_weekdays.csv")
amsterdam_weekends <- read.csv("~/Airbnb data/amsterdam_weekends.csv")
amsterdam <- rbind(amsterdam_weekdays, amsterdam_weekends)
str(amsterdam)
library(gt)
```

Creating data frame to  the summary statistics
Excluding non-numeric variables
```{r
summary_df <- data.frame(
  Variable = names(amsterdam)[-c(1:7)],  
  Minimum = sapply(amsterdam[, -c(1:7)], min),  
  Q1 = sapply(amsterdam[, -c(1:7)], quantile, probs = 0.25),  
  Median = sapply(amsterdam[, -c(1:7)], median),  
  Mean = sapply(amsterdam[, -c(1:7)], mean),  
  Q3 = sapply(amsterdam[, -c(1:7)], quantile, probs = 0.75),
  Maximum = sapply(amsterdam[, -c(1:7)], max) 
)
```

Creating a gt table
```{r
summary_table <- gt(summary_df) %>%
  tab_spanner(label = "Summary Statistics") %>%
  tab_header(
    title = "Summary Statistics",
    subtitle = "Table displaying summary statistics for Amsterdam dataset"
  )
print(summary_table)
```

# Visualize data distributions of key values: realSum, cleanliness_rating, guest_satisfaction_overall, dist, and metro_dist

```{r
par(mfrow = c(3, 2))  # Set up a 3x2 grid for plots
# Histograms
hist(amsterdam$realSum, main = "Distribution of Total Price", xlab = "Total Price (realSum)", col = "pink")
hist(amsterdam$cleanliness_rating, main = "Distribution of Cleanliness Rating", xlab = "Cleanliness Rating", col = "lightgreen")
hist(amsterdam$guest_satisfaction_overall, main = "Distribution of Guest Satisfaction", xlab = "Overall Guest Satisfaction", col = "salmon")
hist(amsterdam$dist, main = "Distribution of Distance from City Center", xlab = "Distance (km)", col = "lightyellow")
hist(amsterdam$metro_dist, main = "Distribution of Distance from Metro", xlab = "Distance (km)", col = "lavender")
```

# Box plots
```{r
boxplot(amsterdam$realSum, main = "Box Plot of Total Price", col = "pink")
# Box plot for cleanliness rating
boxplot(amsterdam$cleanliness_rating, main = "Box Plot of Cleanliness Rating", col = "lightgreen")
# Box plot for guest satisfaction overall
boxplot(amsterdam$guest_satisfaction_overall, main = "Box Plot of Guest Satisfaction Overall", col = "salmon")
# Box plot for distance from city center
boxplot(amsterdam$dist, main = "Box Plot of Distance from City Center", col = "lightyellow")
# Box plot for distance from metro station
boxplot(amsterdam$metro_dist, main = "Box Plot of Distance from Metro Station", col = "lavender")
```
# Ploting the spatial distribution of Airbnb listings in Amsterdam. Creating a scatter plot where each point represents the location of an Airbnb listing in Amsterdam. The lng (longitude) and lat (latitude) columns from the dataset are used as the x and y coordinates, respectively. The alpha parameter is used to control the transparency of the points, making it easier to visualize overlapping listings
```{r
library(ggplot2)
ggplot(data = amsterdam, aes(x = lng, y = lat)) +
  geom_point(alpha = 0.5) +
  labs(title = "Spatial Distribution of Airbnb Listings in Amsterdam",
       x = "Longitude", y = "Latitude") +
  theme_minimal()
  ```
 

# a Leaflet map
```{r
leaflet(data = amsterdam) %>%
  addTiles() %>%
  addCircleMarkers(
    lng = ~lng,  # Longitude
    lat = ~lat,  # Latitude
    radius = 3,  # Adjust the size of the dots as needed
    color = "salmon",  # Color of the dots
    fillOpacity = 0.7,  # Opacity of the dots
    popup = ~paste("Guest Satisfaction Overall:", guest_satisfaction_overall)
  ) %>%
  addLegend("bottomright", 
            colors = "salmon", 
            labels = "Guest Satisfaction Overall",
            opacity = 0.7)
            ```
            
#K-means clustering & Plotting the clustered data
```{r
kmeans_result <- kmeans(amsterdam[, c("lng", "lat")], centers = 5)
amsterdam$cluster <- as.factor(kmeans_result$cluster)
ggplot(data = amsterdam, aes(x = lng, y = lat, color = cluster)) +
  geom_point(alpha = 0.5) +
  labs(title = "K-means Clustering of Airbnb Listings in Amsterdam",
       x = "Longitude", y = "Latitude",
       color = "Cluster") +
  theme_minimal()
```
# Compute Moran's I
```{r
library(spdep)

# Compute Moran's I for guest satisfaction overall
moran_guest <- moran.test(amsterdam$guest_satisfaction_overall, W)

# Compute Moran's I for cleanliness rating
moran_cleanliness <- moran.test(amsterdam$cleanliness_rating, W)

# Compute Moran's I for realSum
moran_realSum <- moran.test(amsterdam$realSum, W)

# Compute Moran's I for distance from city center
moran_dist <- moran.test(amsterdam$dist, W)

# Compute Moran's I for distance from metro
moran_metro_dist <- moran.test(amsterdam$metro_dist, W)

# Print Moran's I results
print(moran_guest)
print(moran_cleanliness)
print(moran_realSum)
print(moran_dist)
print(moran_metro_dist)
```


#Kernel Density Estimation of Airbnb Listings in Amsterdam
```{r
library(ggplot2)
ggplot(amsterdam, aes(x = lng, y = lat)) +
  geom_density_2d() +
  labs(title = "Kernel Density Estimation of Airbnb Listings in Amsterdam",
       x = "Longitude", y = "Latitude")
       ```


